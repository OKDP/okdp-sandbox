#
# Copyright 2026 The OKDP Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# you may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.
#

apiVersion: v1alpha1
name: coredns-patch
tag: 1.0.0-p04
protected: false
description: |
  CoreDNS configuration patch to resolve local domain names to ingress controller
usage:
  text: |
    CoreDNS Patch configures CoreDNS to automatically resolve domain names 
    matching the ingress suffix pattern to the ingress controller.
    This enables local development with custom domain names.
schema:
  parameters:
    properties:
      ingressService: { type: string, default: "ingress-nginx-controller.ingress-nginx.svc.cluster.local" }
  context:
    properties:
      ingress:
        required: true
        properties:
          suffix: { type: string, required: true }
modules:
  - name: main
    timeout: 10m
    source:
      local:
        path: ./chart/0.1.0
    values: |
      ingressSuffix: "{{ .Context.ingress.suffix }}"
      ingressService: "{{ .Parameters.ingressService }}"
      job:
        image: quay.io/okdp/sandbox-images/kubectl:latest
        restartPolicy: OnFailure
        nodeSelector:
          kubernetes.io/os: linux
roles:
  - coredns
dependencies: []